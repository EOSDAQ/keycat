version: 0.2
phases:
  install:
    runtime-versions:
      nodejs: 10
    commands:
      - COMMIT_REF=$(echo $CODEBUILD_RESOLVED_SOURCE_VERSION | cut -c 1-7)
      - BRANCH=develop
      - echo build with commit ${COMMIT_REF}...
      - curl -o- -L https://yarnpkg.com/install.sh | bash
      - yarn install --pure-lockfile --prod
  build:
    commands:
      - yarn build
  post_build:
    commands:
      - aws s3 sync public s3://keycat.co/develop/${COMMIT_REF}
      - aws cloudfront update-distribution --id E227N52V1F7MY8 --default-root-object develop/${COMMIT_REF}/index.html

cache:
  paths:
  - 'node_modules/**/*'

# artifacts:
#   files:
#     - 'public/**/*'